.text
# sbox_inv table
	li t0, 0x52
	sb t0, 256
	li t0, 0x9
	sb t0, 257
	li t0, 0x6a
	sb t0, 258
	li t0, 0xd5
	sb t0, 259
	li t0, 0x30
	sb t0, 260
	li t0, 0x36
	sb t0, 261
	li t0, 0xa5
	sb t0, 262
	li t0, 0x38
	sb t0, 263
	li t0, 0xbf
	sb t0, 264
	li t0, 0x40
	sb t0, 265
	li t0, 0xa3
	sb t0, 266
	li t0, 0x9e
	sb t0, 267
	li t0, 0x81
	sb t0, 268
	li t0, 0xf3
	sb t0, 269
	li t0, 0xd7
	sb t0, 270
	li t0, 0xfb
	sb t0, 271
	li t0, 0x7c
	sb t0, 272
	li t0, 0xe3
	sb t0, 273
	li t0, 0x39
	sb t0, 274
	li t0, 0x82
	sb t0, 275
	li t0, 0x9b
	sb t0, 276
	li t0, 0x2f
	sb t0, 277
	li t0, 0xff
	sb t0, 278
	li t0, 0x87
	sb t0, 279
	li t0, 0x34
	sb t0, 280
	li t0, 0x8e
	sb t0, 281
	li t0, 0x43
	sb t0, 282
	li t0, 0x44
	sb t0, 283
	li t0, 0xc4
	sb t0, 284
	li t0, 0xde
	sb t0, 285
	li t0, 0xe9
	sb t0, 286
	li t0, 0xcb
	sb t0, 287
	li t0, 0x54
	sb t0, 288
	li t0, 0x7b
	sb t0, 289
	li t0, 0x94
	sb t0, 290
	li t0, 0x32
	sb t0, 291
	li t0, 0xa6
	sb t0, 292
	li t0, 0xc2
	sb t0, 293
	li t0, 0x23
	sb t0, 294
	li t0, 0x3d
	sb t0, 295
	li t0, 0xee
	sb t0, 296
	li t0, 0x4c
	sb t0, 297
	li t0, 0x95
	sb t0, 298
	li t0, 0xb
	sb t0, 299
	li t0, 0x42
	sb t0, 300
	li t0, 0xfa
	sb t0, 301
	li t0, 0xc3
	sb t0, 302
	li t0, 0x4e
	sb t0, 303
	li t0, 0x8
	sb t0, 304
	li t0, 0x2e
	sb t0, 305
	li t0, 0xa1
	sb t0, 306
	li t0, 0x66
	sb t0, 307
	li t0, 0x28
	sb t0, 308
	li t0, 0xd9
	sb t0, 309
	li t0, 0x24
	sb t0, 310
	li t0, 0xb2
	sb t0, 311
	li t0, 0x76
	sb t0, 312
	li t0, 0x5b
	sb t0, 313
	li t0, 0xa2
	sb t0, 314
	li t0, 0x49
	sb t0, 315
	li t0, 0x6d
	sb t0, 316
	li t0, 0x8b
	sb t0, 317
	li t0, 0xd1
	sb t0, 318
	li t0, 0x25
	sb t0, 319
	li t0, 0x72
	sb t0, 320
	li t0, 0xf8
	sb t0, 321
	li t0, 0xf6
	sb t0, 322
	li t0, 0x64
	sb t0, 323
	li t0, 0x86
	sb t0, 324
	li t0, 0x68
	sb t0, 325
	li t0, 0x98
	sb t0, 326
	li t0, 0x16
	sb t0, 327
	li t0, 0xd4
	sb t0, 328
	li t0, 0xa4
	sb t0, 329
	li t0, 0x5c
	sb t0, 330
	li t0, 0xcc
	sb t0, 331
	li t0, 0x5d
	sb t0, 332
	li t0, 0x65
	sb t0, 333
	li t0, 0xb6
	sb t0, 334
	li t0, 0x92
	sb t0, 335
	li t0, 0x6c
	sb t0, 336
	li t0, 0x70
	sb t0, 337
	li t0, 0x48
	sb t0, 338
	li t0, 0x50
	sb t0, 339
	li t0, 0xfd
	sb t0, 340
	li t0, 0xed
	sb t0, 341
	li t0, 0xb9
	sb t0, 342
	li t0, 0xda
	sb t0, 343
	li t0, 0x5e
	sb t0, 344
	li t0, 0x15
	sb t0, 345
	li t0, 0x46
	sb t0, 346
	li t0, 0x57
	sb t0, 347
	li t0, 0xa7
	sb t0, 348
	li t0, 0x8d
	sb t0, 349
	li t0, 0x9d
	sb t0, 350
	li t0, 0x84
	sb t0, 351
	li t0, 0x90
	sb t0, 352
	li t0, 0xd8
	sb t0, 353
	li t0, 0xab
	sb t0, 354
	li t0, 0x0
	sb t0, 355
	li t0, 0x8c
	sb t0, 356
	li t0, 0xbc
	sb t0, 357
	li t0, 0xd3
	sb t0, 358
	li t0, 0xa
	sb t0, 359
	li t0, 0xf7
	sb t0, 360
	li t0, 0xe4
	sb t0, 361
	li t0, 0x58
	sb t0, 362
	li t0, 0x5
	sb t0, 363
	li t0, 0xb8
	sb t0, 364
	li t0, 0xb3
	sb t0, 365
	li t0, 0x45
	sb t0, 366
	li t0, 0x6
	sb t0, 367
	li t0, 0xd0
	sb t0, 368
	li t0, 0x2c
	sb t0, 369
	li t0, 0x1e
	sb t0, 370
	li t0, 0x8f
	sb t0, 371
	li t0, 0xca
	sb t0, 372
	li t0, 0x3f
	sb t0, 373
	li t0, 0xf
	sb t0, 374
	li t0, 0x2
	sb t0, 375
	li t0, 0xc1
	sb t0, 376
	li t0, 0xaf
	sb t0, 377
	li t0, 0xbd
	sb t0, 378
	li t0, 0x3
	sb t0, 379
	li t0, 0x1
	sb t0, 380
	li t0, 0x13
	sb t0, 381
	li t0, 0x8a
	sb t0, 382
	li t0, 0x6b
	sb t0, 383
	li t0, 0x3a
	sb t0, 384
	li t0, 0x91
	sb t0, 385
	li t0, 0x11
	sb t0, 386
	li t0, 0x41
	sb t0, 387
	li t0, 0x4f
	sb t0, 388
	li t0, 0x67
	sb t0, 389
	li t0, 0xdc
	sb t0, 390
	li t0, 0xea
	sb t0, 391
	li t0, 0x97
	sb t0, 392
	li t0, 0xf2
	sb t0, 393
	li t0, 0xcf
	sb t0, 394
	li t0, 0xce
	sb t0, 395
	li t0, 0xf0
	sb t0, 396
	li t0, 0xb4
	sb t0, 397
	li t0, 0xe6
	sb t0, 398
	li t0, 0x73
	sb t0, 399
	li t0, 0x96
	sb t0, 400
	li t0, 0xac
	sb t0, 401
	li t0, 0x74
	sb t0, 402
	li t0, 0x22
	sb t0, 403
	li t0, 0xe7
	sb t0, 404
	li t0, 0xad
	sb t0, 405
	li t0, 0x35
	sb t0, 406
	li t0, 0x85
	sb t0, 407
	li t0, 0xe2
	sb t0, 408
	li t0, 0xf9
	sb t0, 409
	li t0, 0x37
	sb t0, 410
	li t0, 0xe8
	sb t0, 411
	li t0, 0x1c
	sb t0, 412
	li t0, 0x75
	sb t0, 413
	li t0, 0xdf
	sb t0, 414
	li t0, 0x6e
	sb t0, 415
	li t0, 0x47
	sb t0, 416
	li t0, 0xf1
	sb t0, 417
	li t0, 0x1a
	sb t0, 418
	li t0, 0x71
	sb t0, 419
	li t0, 0x1d
	sb t0, 420
	li t0, 0x29
	sb t0, 421
	li t0, 0xc5
	sb t0, 422
	li t0, 0x89
	sb t0, 423
	li t0, 0x6f
	sb t0, 424
	li t0, 0xb7
	sb t0, 425
	li t0, 0x62
	sb t0, 426
	li t0, 0xe
	sb t0, 427
	li t0, 0xaa
	sb t0, 428
	li t0, 0x18
	sb t0, 429
	li t0, 0xbe
	sb t0, 430
	li t0, 0x1b
	sb t0, 431
	li t0, 0xfc
	sb t0, 432
	li t0, 0x56
	sb t0, 433
	li t0, 0x3e
	sb t0, 434
	li t0, 0x4b
	sb t0, 435
	li t0, 0xc6
	sb t0, 436
	li t0, 0xd2
	sb t0, 437
	li t0, 0x79
	sb t0, 438
	li t0, 0x20
	sb t0, 439
	li t0, 0x9a
	sb t0, 440
	li t0, 0xdb
	sb t0, 441
	li t0, 0xc0
	sb t0, 442
	li t0, 0xfe
	sb t0, 443
	li t0, 0x78
	sb t0, 444
	li t0, 0xcd
	sb t0, 445
	li t0, 0x5a
	sb t0, 446
	li t0, 0xf4
	sb t0, 447
	li t0, 0x1f
	sb t0, 448
	li t0, 0xdd
	sb t0, 449
	li t0, 0xa8
	sb t0, 450
	li t0, 0x33
	sb t0, 451
	li t0, 0x88
	sb t0, 452
	li t0, 0x7
	sb t0, 453
	li t0, 0xc7
	sb t0, 454
	li t0, 0x31
	sb t0, 455
	li t0, 0xb1
	sb t0, 456
	li t0, 0x12
	sb t0, 457
	li t0, 0x10
	sb t0, 458
	li t0, 0x59
	sb t0, 459
	li t0, 0x27
	sb t0, 460
	li t0, 0x80
	sb t0, 461
	li t0, 0xec
	sb t0, 462
	li t0, 0x5f
	sb t0, 463
	li t0, 0x60
	sb t0, 464
	li t0, 0x51
	sb t0, 465
	li t0, 0x7f
	sb t0, 466
	li t0, 0xa9
	sb t0, 467
	li t0, 0x19
	sb t0, 468
	li t0, 0xb5
	sb t0, 469
	li t0, 0x4a
	sb t0, 470
	li t0, 0xd
	sb t0, 471
	li t0, 0x2d
	sb t0, 472
	li t0, 0xe5
	sb t0, 473
	li t0, 0x7a
	sb t0, 474
	li t0, 0x9f
	sb t0, 475
	li t0, 0x93
	sb t0, 476
	li t0, 0xc9
	sb t0, 477
	li t0, 0x9c
	sb t0, 478
	li t0, 0xef
	sb t0, 479
	li t0, 0xa0
	sb t0, 480
	li t0, 0xe0
	sb t0, 481
	li t0, 0x3b
	sb t0, 482
	li t0, 0x4d
	sb t0, 483
	li t0, 0xae
	sb t0, 484
	li t0, 0x2a
	sb t0, 485
	li t0, 0xf5
	sb t0, 486
	li t0, 0xb0
	sb t0, 487
	li t0, 0xc8
	sb t0, 488
	li t0, 0xeb
	sb t0, 489
	li t0, 0xbb
	sb t0, 490
	li t0, 0x3c
	sb t0, 491
	li t0, 0x83
	sb t0, 492
	li t0, 0x53
	sb t0, 493
	li t0, 0x99
	sb t0, 494
	li t0, 0x61
	sb t0, 495
	li t0, 0x17
	sb t0, 496
	li t0, 0x2b
	sb t0, 497
	li t0, 0x4
	sb t0, 498
	li t0, 0x7e
	sb t0, 499
	li t0, 0xba
	sb t0, 500
	li t0, 0x77
	sb t0, 501
	li t0, 0xd6
	sb t0, 502
	li t0, 0x26
	sb t0, 503
	li t0, 0xe1
	sb t0, 504
	li t0, 0x69
	sb t0, 505
	li t0, 0x14
	sb t0, 506
	li t0, 0x63
	sb t0, 507
	li t0, 0x55
	sb t0, 508
	li t0, 0x21
	sb t0, 509
	li t0, 0xc
	sb t0, 510
	li t0, 0x7d
	sb t0, 511

addi a1, zero, 5    # rs1
addi a2, zero, 8    # rs2
addi a3, zero, 2    # bs

slli a3, a3, 3      #  shamt = bs @ 0b000

srl  a4, a2, a3     # (X(rs2)[31..0] >> shamt)
andi a4, a4, 255    # si = (X(rs2)[31..0] >> shamt)[7..0]

lb a5, (a4)         # so = 0x000000 @ aes_sbox_inv(si) in a5

jal rol             # rol32(so, unsigned(shamt)) in a0

xor a0, a1, a0      # result = X(rs1)[31..0] ^ rol32(so, unsigned(shamt))

loop:
   j loop
   
rol:
   andi t0, a3, 31      # shamt = X(rs2)[4..0]
   sll t2, a5, t0      # (X(rs1) << shamt)
   
   addi t1, zero, 32   # xlen
   sub t1, t1, t0      # (xlen - shamt)
   srl t1, a5, t1      # (X(rs1) >> (xlen - shamt))
   
   or a0, t2, t1
   jr ra